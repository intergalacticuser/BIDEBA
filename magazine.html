<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BDB Coin Magazine</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: #000;
        color: white;
        font-family: 'Arial', sans-serif;
        display: flex;
        flex-direction: column;
        height: 100vh;
        position: relative;
      }
      
      /* Background Canvas */
      #background-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
      }
      
      /* Back Button */
      #back-button {
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 10;
      }
      
      #back-button button {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 1.2rem;
        font-weight: bold;
        padding: 5px 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background 0.3s ease;
      }
      
      #back-button button:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      /* Magazine Container */
      #magazine-container {
        position: relative;
        width: 100%;
        padding-top: 56.25%; /* Aspect ratio: 16:9 */
        margin-top: 20px;
        z-index: 5;
        opacity: 0;
        transition: opacity 0.5s ease-in-out;
      }
      
      #magazine-container.loaded {
        opacity: 1;
      }
      
      #magazine-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
      }
      
      /* Loading indicator */
      .loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        background: rgba(0, 0, 0, 0.7);
        z-index: 6;
        opacity: 1;
        transition: opacity 0.5s ease-in-out;
      }
      
      .loading-overlay.hidden {
        opacity: 0;
        pointer-events: none;
      }
      
      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 5px solid rgba(0, 198, 255, 0.3);
        border-top: 5px solid #00c6ff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
  </head>
  <body>
    <!-- Background Canvas -->
    <canvas id="background-canvas"></canvas>
    
    <!-- Back Button -->
    <div id="back-button">
      <button onclick="location.href='index.html'">Back</button>
    </div>

    <!-- Magazine Container -->
    <div id="magazine-container">
      <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
      </div>
      <iframe 
        src="https://rss.app/embed/v1/magazine/_XzrDDuW8zJzoioSc" 
        frameborder="0"
        scrolling="no"
        onload="onIframeLoad()"
      ></iframe>
    </div>

    <script>
      // Флаг для отслеживания загрузки iframe
      let iframeLoaded = false;
      
      // Функция, вызываемая при загрузке iframe
      function onIframeLoad() {
        if (!iframeLoaded) {
          iframeLoaded = true;
          const container = document.getElementById('magazine-container');
          const overlay = document.getElementById('loading-overlay');
          
          // Плавное появление контента
          setTimeout(() => {
            container.classList.add('loaded');
            overlay.classList.add('hidden');
          }, 300);
        }
      }
      
      document.addEventListener('DOMContentLoaded', () => {
        const canvas = document.getElementById('background-canvas');
        const ctx = canvas.getContext('2d');
        
        if (!ctx) {
          console.error("Canvas context not supported");
          return;
        }
        
        function resizeCanvas() {
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;
        }
        
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        const fontSize = Math.max(12, Math.min(25, window.innerWidth / 40));
        const columns = Math.floor(canvas.width / (fontSize * 0.7));
        const drops = [];
        const trailLength = 3;
        const glowIntensity = 10;
        let pulseFactor = 1;
        let pulseDirection = 1;
        
        for (let i = 0; i < columns; i++) {
          drops[i] = { y: 1, trail: [] };
        }
        
        let speedState = 0;
        const speedLevels = [0.6, 0.8, 1.0, 1.2, 0.4];
        
        function drawFallingLetters() {
          ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          ctx.font = `${fontSize}px Arial`;
          pulseFactor += pulseDirection * 0.05;
          if (pulseFactor >= 1.5 || pulseFactor <= 0.5) {
            pulseDirection *= -1;
          }
          for (let i = 0; i < drops.length; i++) {
            const text = letters[Math.floor(Math.random() * letters.length)];
            const x = i * fontSize * 0.7;
            const y = drops[i].y * fontSize;
            const h = Math.random() * 360;
            const s = 70 + Math.random() * 30;
            const l = 50 + Math.random() * 20;
            const glowSize = glowIntensity * pulseFactor;
            ctx.shadowBlur = glowSize;
            ctx.shadowColor = `hsl(${h}, ${s}%, ${l}%)`;
            ctx.fillStyle = `hsl(${h}, ${s}%, ${l - 10}%)`;
            ctx.fillText(text, x, y);
            drops[i].trail.push({ x, y, alpha: 1 });
            while (drops[i].trail.length > trailLength) {
              drops[i].trail.shift();
            }
            drops[i].trail.forEach((point, index) => {
              const alpha = 0.4 - (index / trailLength);
              ctx.globalAlpha = alpha;
              ctx.fillStyle = `hsla(${h}, ${s}%, ${l - 10}%, ${alpha})`;
              ctx.fillText(text, point.x, point.y);
            });
            ctx.globalAlpha = 1;
            if (y > canvas.height || Math.random() > 0.97) {
              drops[i].y = 0;
              drops[i].trail = [];
            }
            drops[i].y += speedLevels[speedState];
          }
          ctx.shadowBlur = 0;
          ctx.shadowColor = 'transparent';
        }
        
        canvas.addEventListener('mousedown', () => {
          speedState = (speedState + 1) % speedLevels.length;
          console.log(`Current speed state: ${speedState}`);
        });
        
        // Start animation
        setInterval(drawFallingLetters, 30);
        
        // Дополнительная проверка на случай, если iframe загрузился до DOMContentLoaded
        const iframe = document.querySelector('#magazine-container iframe');
        if (iframe && iframe.contentDocument && iframe.contentDocument.readyState === 'complete') {
          onIframeLoad();
        }
      });
    </script>
  </body>
</html>
